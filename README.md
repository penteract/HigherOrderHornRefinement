Higher Order Horn Refinement
============================

##Build
This uses the packages *parsec* and *mtl*, which can be installed using Cabal.

To build, simply run `ghc Main`.

##Run
`Main inputFile outputFile` is the easiest way to call the program.
`Main -h` gives more information about command line options.

`tests/test.sh` should be called from the base diectory.
It will run some tests then `git diff --stat tests` to check that the output is what it is supposed to be.
It will produce no output if it runs without errors.

##Input format
For an example of a complete input file, see tests/test1.inp.

The **environment** section must consist of a list of variable names with a correct sort for each.
The last line must end in a semicolon.

The **program** section must consist of a list of Horn clauses with the last terminated by a semicolon.
There must be at least one clause where the head begins with `X` for each variable `X` in the environment.
All heads of clauses that begin with the same variable must be identical;
i.e. if `P y z => X y z` is a clause then another clause must be `Q y z => X y z` rather than `Q a b => X a b`.

The **goal** section must consist of a single formula.

Variables should not be of the form `x_<number>` as this could interfere with the fresh variables generated by the program.


The program accepts unicode input, but unicode symbols may be used interchangeably with the following ascii versions.
```
^    ∧
\/   ∨
=>   ⇒
A    ∀
E    ∃
<=>  ⇔
<=   ≤
-    −
->   →
```

Comments begin with # and end at the end of a line.

##Output format
The output consists of a list of first order Horn clauses of with heads of the form `X a b c`.
This represents a conjunction of clauses where the variables `a`, `b` and `c` are bound under universal quantifiers.

There is another line giving a first order goal clause.

##Use with z3
The options -y and -z output in the SMT-LIB2 format with the extensions described in http://rise4fun.com/Z3/tutorial/fixedpoints.
These work with z3 versions <=4.4.1 and >=4.4.2 respectively.

The -x option outputs in unextended SMT-LIB format which works with all tested versions of Z3.
It has not been tested with any SMT-LIB solvers other than Z3.
Z3 version 4.4.2 produces simpler output with -z than with -x.
